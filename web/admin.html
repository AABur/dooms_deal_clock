<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Админка — Часы судного договорняка</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1115;--card:#161a22;--text:#e6e6e6;--muted:#9aa3b2;--accent:#4da6ff;--ok:#2ecc71;--warn:#f39c12;--err:#e74c3c
    }
    *{box-sizing:border-box}
    body{margin:0;padding:24px;background:var(--bg);color:var(--text);font-family:Roboto, system-ui, -apple-system, Segoe UI, Helvetica, Arial, sans-serif}
    .container{max-width:920px;margin:0 auto;display:flex;gap:16px;flex-direction:column}
    .header{display:flex;justify-content:space-between;align-items:center}
    h1{margin:0;font-family:Montserrat, sans-serif;font-weight:700;font-size:22px}
    a.link{color:var(--accent);text-decoration:underline}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:var(--card);border-radius:10px;padding:16px;border:1px solid #252a33}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{background:#2b3342;color:#fff;border:1px solid #3a4354;border-radius:8px;padding:10px 14px;cursor:pointer}
    button:hover{filter:brightness(1.1)}
    button.primary{background:#2b3f57;border-color:#35506f}
    input[type="number"], input[type="text"]{background:#10141b;color:#fff;border:1px solid #2b3342;border-radius:8px;padding:10px 12px;min-width:140px}
    .status{font-size:14px;color:var(--muted)}
    .status.ok{color:var(--ok)}
    .status.warn{color:var(--warn)}
    .status.err{color:var(--err)}
    .muted{color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .footer{margin-top:12px;color:var(--muted);font-size:13px}
    .kvs{display:grid;grid-template-columns:140px 1fr;gap:6px 12px;font-size:14px}
    .spinner{display:inline-block;width:16px;height:16px;border:2px solid #3a4354;border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;margin-left:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .list{display:flex;flex-direction:column;gap:8px}
    .entry{background:#10141b;border:1px solid #2b3342;border-radius:8px;padding:10px}
    .entry summary{cursor:pointer;list-style:none}
    .entry summary::-webkit-details-marker{display:none}
    .entry .entry-content{margin-top:8px;white-space:pre-wrap;max-height:220px;overflow:auto;color:#cfd6e4;font-size:14px}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Админка — Часы судного договорняка</h1>
      <a class="link" href="index.html">Перейти на страницу публикации</a>
    </div>

    <div class="grid">
      <section class="card">
        <h2 style="margin-top:0">Ручное обновление</h2>
        <div class="row">
          <button id="btnFetch" class="primary">Обновить сейчас</button>
          <span id="fetchStatus" class="status">Готово</span>
        </div>
        <div class="row" style="margin-top:10px">
          <input id="reloadId" type="number" placeholder="ID сообщения" />
          <button id="btnReload">Перезагрузить по ID</button>
          <span id="reloadStatus" class="status">Готово</span>
        </div>
        <hr style="border:none;border-top:1px solid #2b3342;margin:16px 0">
        <div class="row" style="margin-top:0">
          <input id="periodDays" type="number" min="0" placeholder="Дней (0 = все)" value="30" />
          <button id="btnFetchPeriod">Загрузить за период</button>
          <span id="periodStatus" class="status">Готово</span>
        </div>
        <div class="row" style="margin-top:10px">
          <button id="btnReset" style="background:#3a1f26;border-color:#5a2a34">Обнулить базу сообщений</button>
          <span id="resetStatus" class="status">Готово</span>
        </div>
      </section>

      <section class="card">
        <h2 style="margin-top:0">Текущие данные</h2>
        <div id="current" class="kvs">
          <div class="muted">Время:</div>
          <div id="curTime" class="mono">—</div>
          <div class="muted">Создано:</div>
          <div id="curCreated" class="mono">—</div>
          <div class="muted">Message ID:</div>
          <div id="curMsgId" class="mono">—</div>
        </div>
        <div class="footer">Данные берутся с GET <span class="mono">/api/clock/latest</span></div>
      </section>

      <section class="card">
        <h2 style="margin-top:0">Сообщения в базе</h2>
        <div class="row">
          <input id="historyLimit" type="number" min="1" value="20" placeholder="Сколько показать" />
          <button id="btnLoadHistory">Показать</button>
          <span id="historyStatus" class="status">Готово</span>
        </div>
        <div id="historyList" class="list" style="margin-top:12px"></div>
        <div class="footer">Берётся из GET <span class="mono">/api/clock/history?limit=...</span></div>
      </section>
    </div>
  </div>

  <script>
    // Robust loader for admin.js across different deployments:
    // - Dev FastAPI static: /static/admin.html → use relative 'admin.js' (resolves to /static/admin.js)
    // - Nginx static root: /admin.html → use relative 'admin.js' (resolves to /admin.js)
    // - FastAPI route: /admin → use absolute '/static/admin.js'
    (function () {
      function initIfReady() {
        if (window.AdminPage && typeof window.AdminPage.init === "function") {
          window.AdminPage.init();
        }
      }
      var s = document.createElement("script");
      s.async = true;
      s.src = (location.pathname === "/admin") ? "/static/admin.js" : "admin.js";
      s.onload = initIfReady;
      s.onerror = function () {
        var f = document.createElement("script");
        f.async = true;
        f.src = s.src.includes("/static/") ? "/admin.js" : "/static/admin.js";
        f.onload = initIfReady;
        document.body.appendChild(f);
      };
      document.body.appendChild(s);
    })();
  </script>
</body>
<!-- Keep comments in English; UI text in Russian for end users. -->
</html>
